<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VS Points Optimizer - Last War Nexus</title>
    <meta name="description" content="Professional Last War: Survival tracker for maximizing VS points during Alliance Duels and Arms Race events with accurate 6-phase system">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üéØ</text></svg>">
    <link rel="stylesheet" href="style.css">
    <style>
        /* IMPROVED: Setup modal styling - no ugly scrollbar */
        .setup-modal-content {
            max-height: 90vh;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--accent-primary) var(--bg-tertiary);
        }
        
        .setup-modal-content::-webkit-scrollbar {
            width: 6px;
        }
        
        .setup-modal-content::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
            border-radius: 3px;
        }
        
        .setup-modal-content::-webkit-scrollbar-thumb {
            background: var(--accent-primary);
            border-radius: 3px;
        }
        
        .setup-modal-content::-webkit-scrollbar-thumb:hover {
            background: var(--accent-primary-dark);
        }

        /* FIXED: Settings dropdown max-height to prevent scrollbar issues */
        .settings-dropdown {
            max-height: min(500px, calc(100vh - 120px));
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--accent-primary) var(--bg-tertiary);
        }
        
        .settings-dropdown::-webkit-scrollbar {
            width: 6px;
        }
        
        .settings-dropdown::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
            border-radius: 3px;
        }
        
        .settings-dropdown::-webkit-scrollbar-thumb {
            background: var(--accent-primary);
            border-radius: 3px;
        }

        /* IMPROVED: Save button styling */
        .save-settings-btn {
            width: 100%;
            background: var(--accent-primary);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: var(--border-radius);
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 8px;
        }

        .save-settings-btn:hover {
            background: var(--accent-primary-dark);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 212, 255, 0.3);
        }

        .save-settings-btn:active {
            transform: translateY(0);
        }
    </style>
</head>
<body>
    <nav class="main-nav" role="navigation" aria-label="Main navigation">
        <div class="nav-container">
            <div class="brand-section">
                <div class="brand">
                    <div class="brand-icon-container">
                        <span class="brand-icon" aria-hidden="true">üéØ</span>
                        <div class="brand-glow"></div>
                    </div>
                    <div class="brand-info">
                        <span class="brand-text">Last War Nexus</span>
                        <span class="brand-subtitle">VS Points & Arms Race Optimization</span>
                    </div>
                </div>
            </div>
            <div class="nav-actions">
                <!-- CONSOLIDATED: Single System Settings dropdown -->
                <div class="settings-dropdown-container">
                    <button class="settings-btn" id="settings-toggle" type="button" aria-label="System settings">
                        <span class="settings-icon" aria-hidden="true">‚öôÔ∏è</span>
                        <span class="settings-label">System Settings</span>
                    </button>
                    <div class="settings-dropdown" id="settings-dropdown">
                        <div class="dropdown-header">
                            <h3>System Settings</h3>
                        </div>
                        <div class="dropdown-content">
                            <!-- Server Time Section -->
                            <div class="setting-row">
                                <label for="time-offset">Server Time Adjustment</label>
                                <select id="time-offset" class="dropdown-select">
                                    <option value="-12">UTC -12 hours</option>
                                    <option value="-11">UTC -11 hours</option>
                                    <option value="-10">UTC -10 hours</option>
                                    <option value="-9">UTC -9 hours</option>
                                    <option value="-8">UTC -8 hours</option>
                                    <option value="-7">UTC -7 hours</option>
                                    <option value="-6">UTC -6 hours</option>
                                    <option value="-5">UTC -5 hours</option>
                                    <option value="-4">UTC -4 hours</option>
                                    <option value="-3">UTC -3 hours</option>
                                    <option value="-2">UTC -2 hours</option>
                                    <option value="-1">UTC -1 hour</option>
                                    <option value="0" selected>UTC +0 hours</option>
                                    <option value="1">UTC +1 hour</option>
                                    <option value="2">UTC +2 hours</option>
                                    <option value="3">UTC +3 hours</option>
                                    <option value="4">UTC +4 hours</option>
                                    <option value="5">UTC +5 hours</option>
                                    <option value="5.5">UTC +5.5 hours</option>
                                    <option value="6">UTC +6 hours</option>
                                    <option value="7">UTC +7 hours</option>
                                    <option value="8">UTC +8 hours</option>
                                    <option value="9">UTC +9 hours</option>
                                    <option value="10">UTC +10 hours</option>
                                    <option value="11">UTC +11 hours</option>
                                    <option value="12">UTC +12 hours</option>
                                </select>
                            </div>
                            
                            <!-- Arms Race Phase Overrides -->
                            <div class="setting-row">
                                <label for="current-phase-select">Current Arms Race Phase</label>
                                <select id="current-phase-select" class="dropdown-select">
                                    <option value="">Auto-detect from server time</option>
                                    <option value="city_building">üèóÔ∏è City Building</option>
                                    <option value="unit_progression">‚öîÔ∏è Unit Progression</option>
                                    <option value="tech_research">üî¨ Tech Research</option>
                                    <option value="drone_boost">üöÅ Drone Boost</option>
                                    <option value="hero_advancement">ü¶∏ Hero Advancement</option>
                                    <option value="equipment_enhancement">‚öíÔ∏è Equipment Enhancement</option>
                                </select>
                            </div>
                            
                            <div class="setting-row">
                                <label for="next-phase-select">Next Arms Race Phase</label>
                                <select id="next-phase-select" class="dropdown-select">
                                    <option value="">Auto-detect from current phase</option>
                                    <option value="city_building">üèóÔ∏è City Building</option>
                                    <option value="unit_progression">‚öîÔ∏è Unit Progression</option>
                                    <option value="tech_research">üî¨ Tech Research</option>
                                    <option value="drone_boost">üöÅ Drone Boost</option>
                                    <option value="hero_advancement">ü¶∏ Hero Advancement</option>
                                    <option value="equipment_enhancement">‚öíÔ∏è Equipment Enhancement</option>
                                </select>
                            </div>
                            
                            <!-- Notifications -->
                            <div class="setting-row">
                                <label for="notifications-toggle">Priority Notifications</label>
                                <select id="notifications-toggle" class="dropdown-select">
                                    <option value="disabled">Disabled</option>
                                    <option value="enabled">Enabled</option>
                                </select>
                            </div>
                            
                            <!-- Action Buttons -->
                            <div class="setting-row">
                                <button id="save-settings" class="save-settings-btn">üíæ Save Settings</button>
                            </div>
                            
                            <div class="setting-row">
                                <button id="setup-button" class="setup-button">üéØ Run Initial Setup</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="app-container">
        <section class="hero-dashboard-compact">
            <div class="dashboard-grid-compact">
                <div class="priority-main-card">
                    <div class="card-header gaming-header">
                        <div class="header-left">
                            <h2>VS Points Optimizer</h2>
                            <div class="live-indicator-small">
                                <div class="pulse-dot-mini"></div>
                                <span>LIVE</span>
                            </div>
                        </div>
                        <div id="server-time" class="server-time-gaming">Loading...</div>
                    </div>
                    <div class="card-content gaming-content">
                        <div class="priority-gaming-hero">
                            <div class="active-now-strip" id="active-now" style="display: none;">
                                <span class="active-badge">ACTIVE</span>
                                <span id="active-action">Use speedups now!</span>
                            </div>
                            <div class="hero-badge">
                                <div class="badge-icon">‚ö°</div>
                                <div id="badge-label" class="badge-label">NEXT HIGH PRIORITY</div>
                            </div>
                            <div class="countdown-gaming-display">
                                <div id="next-priority-time" class="countdown-main-gaming">Loading...</div>
                                <div id="countdown-label" class="countdown-label">TIME REMAINING</div>
                            </div>
                            <div class="event-gaming-card">
                                <div class="event-icon-large" id="event-icon">üî¨</div>
                                <div class="event-details-gaming">
                                    <div class="event-row">
                                        <div id="next-priority-event" class="event-name-gaming">Loading...</div>
                                        <div id="efficiency-level" class="efficiency-badge">High</div>
                                    </div>
                                    <div id="current-action" class="event-action-gaming">Loading recommendations...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="side-cards">
                    <div class="countdown-card-compact">
                        <div class="card-header">
                            <h3>Phase Transition</h3>
                        </div>
                        <div class="card-content">
                            <div id="countdown-timer" class="countdown-value">Loading...</div>
                            <div id="current-phase" class="current-phase">Loading...</div>
                        </div>
                    </div>

                    <div class="strategy-card-compact">
                        <div class="card-header">
                            <h3>Current Status</h3>
                        </div>
                        <div class="card-content">
                            <div><strong>VS Day:</strong> <span id="current-vs-day">Loading...</span></div>
                            <div><strong>Arms Race:</strong> <span id="arms-phase">Loading...</span></div>
                            <div><strong>Priority:</strong> <span id="priority-level">Loading...</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <div class="tab-navigation">
            <div class="tab-container" role="tablist">
                <button class="tab-btn active" data-tab="priority" type="button" role="tab">
                    <div class="tab-content-item">
                        <span class="tab-icon">‚ö°</span>
                        <div class="tab-info">
                            <span class="tab-label">Priority Windows</span>
                            <span class="tab-count" id="priority-count">Loading</span>
                        </div>
                    </div>
                </button>
                <button class="tab-btn" data-tab="schedule" type="button" role="tab">
                    <div class="tab-content-item">
                        <span class="tab-icon">üìÖ</span>
                        <div class="tab-info">
                            <span class="tab-label">Schedule</span>
                            <span class="tab-count">7 Days</span>
                        </div>
                    </div>
                </button>
                <button class="tab-btn" data-tab="guides" type="button" role="tab">
                    <div class="tab-content-item">
                        <span class="tab-icon">üìö</span>
                        <div class="tab-info">
                            <span class="tab-label">Strategy</span>
                            <span class="tab-count">8 Guides</span>
                        </div>
                    </div>
                </button>
            </div>
        </div>

        <main class="main-content">
            <div class="tab-content">
                <div id="priority-tab" class="tab-panel active">
                    <div class="section-header">
                        <h2>High Priority VS Points Windows</h2>
                        <p class="section-subtitle">Optimal timing when Arms Race phases align with Alliance Duel days for maximum efficiency</p>
                    </div>
                    <div id="priority-grid" class="priority-grid">
                        <div class="loading-message">Loading priority windows...</div>
                    </div>
                </div>

                <div id="schedule-tab" class="tab-panel">
                    <div class="section-header">
                        <h2>Complete Event Schedule</h2>
                        <p class="section-subtitle">Full weekly schedule showing Arms Race phases and Alliance Duel days with predictable 4-hour rotations</p>
                    </div>
                    <div id="schedule-content" class="priority-grid">
                        <div class="loading-message">Loading schedule...</div>
                    </div>
                </div>

                <div id="guides-tab" class="tab-panel">
                    <div class="section-header">
                        <h2>Strategy Guides</h2>
                        <p class="section-subtitle">Expert tips for maximizing VS points and Arms Race efficiency with 6-phase system</p>
                    </div>
                    <div id="guides-content" class="priority-grid">
                        <div class="loading-message">Loading guides...</div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div class="priority-banner" id="priority-banner" role="alert">
        <div class="banner-container">
            <div class="banner-content">
                <div class="banner-icon">‚ö°</div>
                <div class="banner-text">
                    <div class="banner-title" id="banner-title">High Priority Active</div>
                </div>
                <div class="banner-time" id="banner-time">Loading...</div>
                <button class="banner-close" id="banner-close" type="button" aria-label="Close notification">√ó</button>
            </div>
        </div>
    </div>

    <div class="sr-only" aria-live="polite" id="status-announcements"></div>

    <!-- IMPROVED: Setup Modal with better styling -->
    <div class="setup-modal" id="setup-modal">
        <div class="setup-modal-backdrop"></div>
        <div class="setup-modal-content">
            <div class="setup-header">
                <div class="setup-icon">üéØ</div>
                <h2>Welcome to Last War Nexus</h2>
                <p>Configure your VS Points optimizer for maximum efficiency with accurate 6-phase Arms Race system</p>
            </div>
            
            <div class="setup-body">
                <div class="setup-section">
                    <h3>Current Server Time</h3>
                    <div class="server-time-display">
                        <div id="setup-server-time" class="setup-time">Loading...</div>
                        <div class="setup-timezone">UTC <span id="setup-timezone-offset">+0</span></div>
                    </div>
                </div>

                <div class="setup-section">
                    <h3>Server Time Adjustment</h3>
                    <p class="setup-help">Adjust UTC time to match your Last War server's time zone</p>
                    <select id="setup-time-offset" class="setup-select">
                        <option value="-12">UTC -12 hours</option>
                        <option value="-11">UTC -11 hours</option>
                        <option value="-10">UTC -10 hours</option>
                        <option value="-9">UTC -9 hours</option>
                        <option value="-8">UTC -8 hours</option>
                        <option value="-7">UTC -7 hours</option>
                        <option value="-6">UTC -6 hours</option>
                        <option value="-5">UTC -5 hours</option>
                        <option value="-4">UTC -4 hours</option>
                        <option value="-3">UTC -3 hours</option>
                        <option value="-2">UTC -2 hours</option>
                        <option value="-1">UTC -1 hour</option>
                        <option value="0" selected>UTC +0 hours</option>
                        <option value="1">UTC +1 hour</option>
                        <option value="2">UTC +2 hours</option>
                        <option value="3">UTC +3 hours</option>
                        <option value="4">UTC +4 hours</option>
                        <option value="5">UTC +5 hours</option>
                        <option value="5.5">UTC +5.5 hours</option>
                        <option value="6">UTC +6 hours</option>
                        <option value="7">UTC +7 hours</option>
                        <option value="8">UTC +8 hours</option>
                        <option value="9">UTC +9 hours</option>
                        <option value="10">UTC +10 hours</option>
                        <option value="11">UTC +11 hours</option>
                        <option value="12">UTC +12 hours</option>
                    </select>
                </div>

                <div class="setup-section">
                    <h3>Current Arms Race Phase</h3>
                    <p class="setup-help">What Arms Race phase is currently active on your server? (Check in-game Arms Race event)</p>
                    <select id="setup-current-phase" class="setup-select">
                        <option value="city_building">üèóÔ∏è City Building (00:00-04:00)</option>
                        <option value="unit_progression">‚öîÔ∏è Unit Progression (04:00-08:00)</option>
                        <option value="tech_research">üî¨ Tech Research (08:00-12:00)</option>
                        <option value="drone_boost">üöÅ Drone Boost (12:00-16:00)</option>
                        <option value="hero_advancement">ü¶∏ Hero Advancement (16:00-20:00)</option>
                        <option value="equipment_enhancement">‚öíÔ∏è Equipment Enhancement (20:00-00:00)</option>
                    </select>
                </div>

                <div class="setup-section">
                    <h3>Next Arms Race Phase</h3>
                    <p class="setup-help">What phase will be active next (in about 4 hours)?</p>
                    <select id="setup-next-phase" class="setup-select">
                        <option value="city_building">üèóÔ∏è City Building</option>
                        <option value="unit_progression">‚öîÔ∏è Unit Progression</option>
                        <option value="tech_research">üî¨ Tech Research</option>
                        <option value="drone_boost">üöÅ Drone Boost</option>
                        <option value="hero_advancement">ü¶∏ Hero Advancement</option>
                        <option value="equipment_enhancement">‚öíÔ∏è Equipment Enhancement</option>
                    </select>
                </div>

                <div class="setup-section">
                    <h3>Priority Notifications</h3>
                    <p class="setup-help">Get notified when high-priority VS point windows are active</p>
                    <div class="notification-options">
                        <label class="notification-option">
                            <input type="radio" name="notifications" value="enabled" checked>
                            <span class="radio-custom"></span>
                            <span class="option-text">Enable Notifications</span>
                        </label>
                        <label class="notification-option">
                            <input type="radio" name="notifications" value="disabled">
                            <span class="radio-custom"></span>
                            <span class="option-text">Skip for Now</span>
                        </label>
                    </div>
                </div>
            </div>

            <div class="setup-footer">
                <button id="setup-skip" class="setup-btn setup-btn-secondary">Skip Setup</button>
                <button id="setup-complete" class="setup-btn setup-btn-primary">Complete Setup</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>